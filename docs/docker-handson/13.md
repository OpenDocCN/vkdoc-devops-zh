Twelve

在本章中，我们将研究以下基于云的容器服务，

1.  谷歌容器引擎
2.  亚马逊集装箱服务(ECS)

谷歌已经在容器上运营多年了。容器引擎项目的灵感来自 Google 在分布式环境中操作基于容器的应用程序的经验。在撰写本书时，它还处于 alpha 阶段，还不推荐用于生产。

在后端，容器引擎使用 kubernetes 集群来调度和管理容器。在前一章中，我们已经学会了与 kubernetes 一起工作。容器引擎是 kubernetes 集群之上的一个包装器，通过它，您可以从 web 界面和 google cloud CLI 创建 kubernetes 集群。

在这一节中，我们将学习如何创建一个集群，并将一个示例 wordpress 应用程序部署到一个容器引擎上。

注意:要使用容器引擎，您应该有一个经过身份验证的计算引擎帐户和工作站。如果您没有配置工作站，您可以参考前面章节中的 kubernetes 部分。

创建集群

在本节中，我们将学习如何从 web 界面并使用 gcloud cli 创建容器引擎集群。

使用 web 界面

从 web 界面创建集群非常简单，只需几次点击即可完成。按照下面给出的步骤，使用 web 界面设置集群。

1.  登录计算引擎，在计算选项卡下，您可以找到“容器引擎”选项。点击它，你会看到一个“创建集群”选项。单击“创建集群”选项。

![](../images/00325.jpeg)

2.  在下一个窗口中，输入集群配置所需的凭据。例如，集群大小和机器类型。输入所有必要信息后，单击创建选项。

![](../images/00326.jpeg)

3.  将使用给定的凭据创建一个群集，群集的设置需要几分钟时间。

![](../images/00327.jpeg)

使用 gcloud cli

创建容器引擎集群的另一种方式是通过 gcloud cli。按照下面给出的步骤从命令行创建集群。

1.  当您安装 google cloud sdk 时，预览组件将不会包含在其中。因此，您需要使用以下命令更新预览组件。

sudo gcloud 组件更新预览

![](../images/00328.jpeg)

2.  我们已经从 web 界面创建了一个集群。让我们尝试使用以下命令从 cli 获取有关该群集的信息。

注意:用您创建的集群名替换“Docker ”,用您创建集群的区域名替换“asia-east1-a”。这些信息可以从 web 界面获得。

sudo gclolud 预览集装箱群描述 docker - zone asia-east1-a

![](../images/00329.jpeg)

3.  使用以下命令设置两个环境变量 CLUSTER _ NAME 和 ZONE，以便从 cli 创建集群。

gcloud 预览容器集群创建$CLUSTER_NAME - num-nodes 1 \

-机器类型 G1-小区域$区域

![](../images/00330.jpeg)

install kubecfg 客户端

工作站需要安装 kubecgf 客户端，以便在集群上部署 kubernetes pods。

使用以下命令下载 kubecfg linux 客户机。

wget【[】http://storage . Google APIs . com/k8s/Linux/kubi CFG](http://storage.googleapis.com/k8s/linux/kubecfg)

![](../images/00331.jpeg)

使用以下命令更改 kubecfg 文件夹的权限，并将其移动到/usr/local/bin 文件夹。

chmod-x kubi CFG

mv kubi CFG/usr/local/bin

![](../images/00332.jpeg)

现在，我们已经设置了从 cli 部署容器的所有配置。执行下面的 gcloud 命令，从 tutum/wordpress 映像部署一个 wordpress 容器。

gcloud 预览容器 pods-CLUSTER-NAME $ CLUSTER _ NAME create WordPress \

-image = tutum/WordPress-port = 80-ZONE $ ZONE

![](../images/00333.jpeg)

要获得关于我们刚刚创建的容器的信息，请执行下面的 gcloud describe 命令。

sudo gclolud 预览容器 pods-CLUSTER-NAME \ $ CLUSTER _ NAME 描述

![](../images/00334.jpeg)

从输出中，您可以查看容器 IP、状态和其他信息。状态显示它正在运行。

让我们试着从浏览器访问 wordpress 应用程序。

注意:从集群中打开实例的网络设置中的端口 80，以在浏览器中查看应用程序。

![](../images/00335.jpeg)

现在我们有了一个在容器引擎上运行的 WordPress 应用程序。

亚马逊网络服务有一个容器服务叫做 ec2 容器服务。在写这本书的时候，它处于预览模式。在本节中，我们将讨论 ec2 容器服务及其特性。

EC2 容器服务是一个高度可伸缩的容器管理服务。ECS 支持 Docker，它可以管理任何规模的容器。该服务使得在集群中部署容器来运行分布式应用程序变得容易。ECS 具有以下特性。

1.管理您的容器(元数据、实例类型等。,)

2.将容器安排到您的群中。

3.将容器从几个扩展到数百个

4.高性能，集群在 VPC 内部运行。

5.管理群集状态。使用简单的 API 调用，您可以启动和终止容器

6.您可以通过从集中式服务查询集群来获得容器的状态。

7.除了容器，您还可以利用其他 AWS 特性，如安全组、ECS 卷、策略等。为了增强安全性。

8.您可以在可用性区域之间的集群中分发容器

9.不再需要第三方容器集群管理工具。

10.ECS 是一项免费服务，您只需为您使用的后端 ec2 资源付费。

Docker 兼容性

ec2 容器服务支持 Docker 平台。您可以在 ECS 集群中运行和管理 Docker 容器。ECS 集群中的所有 ec2 机器都捆绑了 Docker 守护进程。因此不需要额外配置服务器来设置 Docker 守护进程。您可以无缝地将容器从开发环境部署到 ECS 集群。

受管集群

Docker 容器部署中一个具有挑战性的部分是集群管理和监控。通过处理所有复杂的集群配置，ECS 让您的生活变得如此简单。您可以专注于容器部署及其任务，将所有复杂的集群配置留给 ECS。

程序控制

您可以使用 ECS 丰富的 API 特性将其与任何应用程序集成。可以使用 ECS API 以编程方式管理集群管理和容器操作。

调度程序

ECS 有一个高效的调度器，它将容器调度到集群上。调度程序决定应该在哪个主机上部署容器。ECS 的另一个有趣的特性是，您可以开发自己的调度程序，也可以使用其他第三方调度程序。

坞站存储库

您可以使用 Docker 公共注册中心、您自己的私有注册中心和第三方注册中心进行映像管理和容器部署。应该在用于容器部署的任务文件中指定要与 ECS 一起使用的注册中心。

现在我们来看一下 ECS 的核心组件。

Ec2 容器服务有四个主要组件，

1.  任务
2.  容器
3.  簇
4.  容器实例

任务

Task 是一个用于调度容器的声明性 JSON 模板。任务是一组相关的容器。一个任务的范围可以从一个到多个具有链接、共享卷等的容器。下面给出了一个任务定义示例。

{

“家庭”:“Docker-网站”，

"版本":" 1.0 "

“容器”:[

<container definitions=""></container>

]}

容器定义

容器定义包含以下内容

1.容器名称

2.形象

3.运行时属性(端口、环境变量等)

下面给出了一个容器定义的例子

{

"名称":"数据库服务器"，

「图片」:「Ubuntu:最新」，

"端口映射":[{ " contianerport " " 3306，" host port ":3308

}

簇

群集为您的任务提供了一个资源池。它对所有容器实例进行分组。

容器实例

容器实例是安装了 ECS 代理的 EC2 实例，或者是安装了 ECS 代理的 AMI。每个容器实例将在启动时向集群注册自己。